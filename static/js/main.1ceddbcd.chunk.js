(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{20:function(e,t,n){e.exports={formBlock:"InitialForm_formBlock__rDqLk",input:"InitialForm_input__2EaoX",button1:"InitialForm_button1__3XYse"}},5:function(e,t,n){e.exports={chatWrapper:"ChatRoom_chatWrapper__1Ac5s",chatBlock:"ChatRoom_chatBlock__2dAOE",onlineUsersBlock:"ChatRoom_onlineUsersBlock__1InHk",messages:"ChatRoom_messages__kAgVk",mineMessage:"ChatRoom_mineMessage__1Btyi",strangeMessage:"ChatRoom_strangeMessage__32v9x",adminMessage:"ChatRoom_adminMessage__2qZvh",enterMessageBlock:"ChatRoom_enterMessageBlock__zQps6",elem:"ChatRoom_elem__3KXHm",button2:"ChatRoom_button2__kmU0Y"}},53:function(e,t,n){e.exports={App:"App_App__16Ua0"}},60:function(e,t,n){},96:function(e,t,n){"use strict";n.r(t);var s=n(0),c=n.n(s),a=n(23),r=n.n(a),o=(n(60),n(2)),i=n(53),u=n.n(i),l=n(13),m=n(12),d=n(35),j=n(3),b=n(54),h=n.n(b),g={socket:null,createConnection:function(){this.socket=h()("https://back-fora-soft-test.herokuapp.com",{transports:["websocket"]})},destroyConnection:function(){var e;null===(e=this.socket)||void 0===e||e.disconnect(),this.socket=null},sendClientData:function(e,t){var n;null===(n=this.socket)||void 0===n||n.emit("client-user-joined",e,(function(e){t(e)}))},subscribe:function(e,t,n){var s,c,a;null===(s=this.socket)||void 0===s||s.on("init-messages-published",e),null===(c=this.socket)||void 0===c||c.on("new-message-sent",t),null===(a=this.socket)||void 0===a||a.on("user-is-typing",n)},sendMessage:function(e){var t;null===(t=this.socket)||void 0===t||t.emit("client-message-sent",e,(function(e){e&&alert(e)}))},typeMessage:function(){var e;null===(e=this.socket)||void 0===e||e.emit("client-typed")},clientDeleteAllMessages:function(){var e;null===(e=this.socket)||void 0===e||e.emit("client-deleted-all-messages")}},f={user:{id:"",name:"",room:""},messages:[],typingUsers:[]},O=n(5),p=n.n(O),v=n(1),_=function(){var e=Object(m.c)((function(e){return e.chat})),t=e.user,n=e.messages,c=e.typingUsers,a=Object(m.b)(),r=Object(o.f)();Object(s.useEffect)((function(){return a((function(e,t){g.createConnection(),g.subscribe((function(t){e(function(e){return{type:"messages-received",messages:e}}(t))}),(function(t){e(function(e){return{type:"new-message-received",message:e}}(t))}),(function(t){e(function(e){return{type:"add-typing-user",user:e}}(t))}));var n=t().chat.user;g.sendClientData(n,(function(t){e(function(e){return{type:"set-userId",userId:e}}(t))}))})),function(){a((function(e){g.destroyConnection(),e({type:"remove-user"})}))}}),[]);var i=Object(s.useState)(""),u=Object(l.a)(i,2),d=u[0],j=u[1],b=Object(s.useState)(!0),h=Object(l.a)(b,2),f=h[0],O=h[1],_=Object(s.useState)(0),x=Object(l.a)(_,2),k=x[0],y=x[1];Object(s.useEffect)((function(){var e;f&&(null===(e=C.current)||void 0===e||e.scrollIntoView({behavior:"smooth"}))}),[n,c]);var C=Object(s.useRef)(null);return Object(v.jsxs)("div",{className:p.a.chatWrapper,children:[Object(v.jsxs)("h1",{children:["Chat page ",t.room]}),Object(v.jsxs)("div",{className:p.a.chatBlock,children:[Object(v.jsx)("div",{className:p.a.onlineUsersBlock,children:[{id:1,name:"\u0421\u0430\u0448\u0430"},{id:2,name:"\u041c\u0430\u0448\u0430"},{id:3,name:"\u041f\u0430\u0448\u0430"}].map((function(e){return Object(v.jsx)("div",{children:e.name},e.id)}))}),Object(v.jsxs)("div",{className:p.a.messages,onScroll:function(e){var t=e.currentTarget,n=t.scrollHeight-t.clientHeight;t.scrollTop>k&&Math.abs(n-t.scrollTop)<5?O(!0):O(!1),y(e.currentTarget.scrollTop)},children:[n.map((function(e){return Object(v.jsxs)("div",{className:(n=e.user.name,"admin"===n?p.a.adminMessage:n===t.name?p.a.mineMessage:p.a.strangeMessage),children:[Object(v.jsxs)("b",{children:[e.user.name,":"]})," ",e.message]},e.id);var n})),c.map((function(e){return Object(v.jsxs)("div",{children:[Object(v.jsx)("b",{children:e.name})," is typing..."]},e.id)})),Object(v.jsx)("div",{ref:C})]}),Object(v.jsxs)("div",{className:p.a.enterMessageBlock,children:[Object(v.jsx)("textarea",{className:p.a.elem,value:d,onKeyPress:function(){a((function(e){g.typeMessage()}))},onChange:function(e){return j(e.currentTarget.value)}}),Object(v.jsx)("button",{className:p.a.button2,onClick:function(){a(function(e){return function(t){g.sendMessage(e)}}(d)),j("")},children:"Send"}),Object(v.jsx)("button",{className:p.a.button2,onClick:function(){a((function(e){g.clientDeleteAllMessages(),e({type:"delete-all-messages"})}))},children:"Delete all messages"}),Object(v.jsx)("button",{className:p.a.button2,onClick:function(){return r.push("/")},children:"Exit from room"})]})]})]})},x=n(20),k=n.n(x),y=function(){var e=Object(o.f)(),t=Object(m.b)(),n=Object(s.useState)(""),c=Object(l.a)(n,2),a=c[0],r=c[1],i=Object(s.useState)(""),u=Object(l.a)(i,2),d=u[0],j=u[1];return Object(v.jsxs)("div",{className:k.a.formBlock,children:["Please, enter your nickname:",Object(v.jsx)("input",{className:k.a.input,onChange:function(e){return r(e.currentTarget.value)}}),"Please, enter room name:",Object(v.jsx)("input",{className:k.a.input,onChange:function(e){return j(e.currentTarget.value)}}),Object(v.jsx)("button",{className:k.a.button1,onClick:function(){t(function(e,t,n){return function(s){s(function(e,t,n){return{type:"set-user",payload:{id:e,name:t,room:n}}}(e,t,n))}}("",a,d)),e.push("chat-room")},children:"Enter"})]})},C=c.a.memo((function(){return Object(v.jsx)("div",{className:u.a.App,children:Object(v.jsxs)(o.c,{children:[Object(v.jsx)(o.a,{path:"/client-fora-soft-test",exact:!0,render:function(){return Object(v.jsx)(y,{})}}),Object(v.jsx)(o.a,{path:"/chat-room",render:function(){return Object(v.jsx)(_,{})}}),Object(v.jsx)(o.a,{path:"*",render:function(){return Object(v.jsx)("div",{children:"404 NOT FOUND"})}})]})})})),M=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,97)).then((function(t){var n=t.getCLS,s=t.getFID,c=t.getFCP,a=t.getLCP,r=t.getTTFB;n(e),s(e),c(e),a(e),r(e)}))},N=n(27),B=n(55),U=n(25),I=Object(N.b)({chat:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"messages-received":return Object(j.a)(Object(j.a)({},e),{},{messages:t.messages});case"new-message-received":return Object(j.a)(Object(j.a)({},e),{},{messages:[].concat(Object(d.a)(e.messages),[t.message]),typingUsers:e.typingUsers.filter((function(e){return e.id!==t.message.user.id}))});case"add-typing-user":return Object(j.a)(Object(j.a)({},e),{},{typingUsers:[].concat(Object(d.a)(e.typingUsers.filter((function(e){return e.id!==t.user.id}))),[t.user])});case"delete-all-messages":return Object(j.a)(Object(j.a)({},e),{},{messages:[]});case"set-user":return Object(j.a)(Object(j.a)({},e),{},{user:{id:t.payload.id,name:t.payload.name,room:t.payload.room}});case"set-userId":return Object(j.a)(Object(j.a)({},e),{},{user:Object(j.a)(Object(j.a)({},e.user),{},{id:t.userId})});case"remove-user":return Object(j.a)(Object(j.a)({},e),{},{user:{id:"",name:"",room:""},messages:[],typingUsers:[]});default:return e}}}),R=Object(N.c)(I,Object(N.a)(B.a));r.a.render(Object(v.jsx)(c.a.StrictMode,{children:Object(v.jsx)(m.a,{store:R,children:Object(v.jsx)(U.a,{children:Object(v.jsx)(C,{})})})}),document.getElementById("root")),M()}},[[96,1,2]]]);
//# sourceMappingURL=main.1ceddbcd.chunk.js.map