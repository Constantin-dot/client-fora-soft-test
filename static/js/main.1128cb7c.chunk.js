(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{105:function(e,t,n){"use strict";n.r(t);var s=n(0),r=n.n(s),c=n(26),o=n.n(c),a=(n(69),n(3)),i=n(59),u=n.n(i),l=n(32),m=n(17),d=n(42),j=n(2),b=n(60),p=n.n(b),h={socket:null,createConnection:function(){this.socket=p()("https://back-fora-soft-test.herokuapp.com",{transports:["websocket"]})},destroyConnection:function(e){var t;null===(t=this.socket)||void 0===t||t.disconnect(e),this.socket=null},leftRoom:function(){var e;null===(e=this.socket)||void 0===e||e.emit("client-user-Left")},sendClientData:function(e,t){var n;null===(n=this.socket)||void 0===n||n.emit("client-user-joined",e,(function(e){t(e)}))},subscribe:function(e,t,n,s,r,c){var o,a,i,u,l,m;null===(o=this.socket)||void 0===o||o.on("init-messages-published",e),null===(a=this.socket)||void 0===a||a.on("new-message-sent",t),null===(i=this.socket)||void 0===i||i.on("user-is-typing",n),null===(u=this.socket)||void 0===u||u.on("user-stoped-typing",s),null===(l=this.socket)||void 0===l||l.on("user-left-room",r),null===(m=this.socket)||void 0===m||m.on("update-users",c)},sendMessage:function(e){var t;null===(t=this.socket)||void 0===t||t.emit("client-message-sent",e,(function(e){e&&alert(e)}))},typeMessage:function(){var e;null===(e=this.socket)||void 0===e||e.emit("client-typed")},stopTypeMessage:function(){var e;null===(e=this.socket)||void 0===e||e.emit("client-stop-typed")}},f={user:{id:"",name:"",room:""},messages:[],typingUsers:[],onlineUsers:[]},O=n(7),g=n.n(O),v=n(1),x=function(){var e=Object(m.c)((function(e){return e.chat})),t=e.user,n=e.messages,r=e.typingUsers,c=e.onlineUsers,o=Object(m.b)(),i=Object(a.f)();Object(s.useEffect)((function(){return o((function(e,t){h.createConnection(),h.subscribe((function(t){e(function(e){return{type:"messages-received",messages:e}}(t))}),(function(t){e(function(e){return{type:"new-message-received",message:e}}(t))}),(function(t){e(function(e){return{type:"add-typing-user",user:e}}(t))}),(function(t){e(function(e){return{type:"remove-typing-user",user:e}}(t))}),(function(){e({type:"delete-all-messages"}),e({type:"remove-user"})}),(function(t){e(function(e){return{type:"update-users-list",users:e}}(t))}));var n=t().chat.user;h.sendClientData(n,(function(t){e(function(e){return{type:"set-userId",userId:e}}(t))}))})),function(){o(function(e){return function(t){h.destroyConnection(e),t({type:"remove-user"}),t({type:"delete-all-messages"})}}(t))}}),[]);var u=Object(s.useState)(""),d=Object(l.a)(u,2),j=d[0],b=d[1],p=Object(s.useState)(!0),f=Object(l.a)(p,2),O=f[0],x=f[1],_=Object(s.useState)(0),y=Object(l.a)(_,2),k=y[0],C=y[1];Object(s.useEffect)((function(){var e;O&&(null===(e=B.current)||void 0===e||e.scrollIntoView({behavior:"smooth"}))}),[n,r]);var B=Object(s.useRef)(null);return Object(v.jsxs)("div",{className:g.a.chatWrapper,children:[Object(v.jsxs)("div",{className:g.a.headerBlock,children:[Object(v.jsxs)("h2",{children:["Chat page ",t.room]}),Object(v.jsx)("button",{className:g.a.exitButton,onClick:function(){o((function(e){h.leftRoom()})),i.push("/client-fora-soft-test")},children:"Exit from room"})]}),Object(v.jsxs)("div",{className:g.a.chatBlock,children:[Object(v.jsx)("div",{className:g.a.onlineUsersBlock,children:c?c.map((function(e){return Object(v.jsx)("div",{children:e.name},e.id)})):Object(v.jsx)("div",{})}),Object(v.jsxs)("div",{className:g.a.messages,onScroll:function(e){var t=e.currentTarget,n=t.scrollHeight-t.clientHeight;t.scrollTop>k&&Math.abs(n-t.scrollTop)<5?x(!0):x(!1),C(e.currentTarget.scrollTop)},children:[n.map((function(e){return Object(v.jsxs)("div",{className:(n=e.user.name,"admin"===n?g.a.adminMessage:n===t.name?g.a.mineMessage:g.a.strangeMessage),children:[Object(v.jsxs)("b",{children:[e.user.name,":"]})," ",e.message]},e.id);var n})),r.map((function(e){return Object(v.jsxs)("div",{children:[Object(v.jsx)("b",{children:e.name})," is typing..."]},e.id)})),Object(v.jsx)("div",{ref:B})]})]}),Object(v.jsxs)("div",{className:g.a.enterMessageBlock,children:[Object(v.jsx)("textarea",{className:g.a.textarea,value:j,onKeyDown:function(){o((function(e){h.typeMessage()}))},onKeyUp:function(){o((function(e){h.stopTypeMessage()}))},onChange:function(e){return b(e.currentTarget.value)}}),Object(v.jsx)("button",{className:g.a.enterButton,onClick:function(){o(function(e){return function(){h.sendMessage(e)}}(j)),b("")},children:"Send"})]})]})},_=n(64),y=n(18),k=n.n(y),C=function(){var e=Object(a.f)(),t=Object(m.b)(),n=Object(_.a)({initialValues:{name:"",room:""},validate:function(e){var t={};return e.name||(t.name="Field is required"),e.room||(t.room="Field is required"),t},onSubmit:function(n){var s,r,c;t((s="",r=n.name,c=n.room,function(e){e(function(e,t,n){return{type:"set-user",payload:{id:e,name:t,room:n}}}(s,r,c))})),e.push("/client-fora-soft-test/chat-room")}});return Object(v.jsxs)("form",{className:k.a.formBlock,onSubmit:n.handleSubmit,children:[Object(v.jsx)("h3",{children:"Websocket chat"}),Object(v.jsx)("p",{children:"Please, enter your nickname:"}),Object(v.jsx)("input",Object(j.a)({className:k.a.input,type:"text",placeholder:"your nickname"},n.getFieldProps("name"))),n.errors.name&&n.touched.name?Object(v.jsx)("div",{className:k.a.errorText,children:n.errors.name}):null,Object(v.jsx)("p",{children:"Please, enter room name:"}),Object(v.jsx)("input",Object(j.a)({className:k.a.input,type:"text",placeholder:"room name"},n.getFieldProps("room"))),n.errors.room&&n.touched.room?Object(v.jsx)("div",{className:k.a.errorText,children:n.errors.room}):null,Object(v.jsx)("button",{className:k.a.button1,type:"submit",children:"Enter"})]})},B=r.a.memo((function(){return Object(v.jsx)("div",{className:u.a.App,children:Object(v.jsxs)(a.c,{children:[Object(v.jsx)(a.a,{path:"/client-fora-soft-test",exact:!0,render:function(){return Object(v.jsx)(C,{})}}),Object(v.jsx)(a.a,{path:"/client-fora-soft-test/chat-room",render:function(){return Object(v.jsx)(x,{})}}),Object(v.jsx)(a.a,{path:"*",render:function(){return Object(v.jsx)("div",{children:"404 NOT FOUND"})}})]})})})),M=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,106)).then((function(t){var n=t.getCLS,s=t.getFID,r=t.getFCP,c=t.getLCP,o=t.getTTFB;n(e),s(e),r(e),c(e),o(e)}))},N=n(33),U=n(63),R=n(28),T=Object(N.b)({chat:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"messages-received":return Object(j.a)(Object(j.a)({},e),{},{messages:t.messages});case"new-message-received":return Object(j.a)(Object(j.a)({},e),{},{messages:[].concat(Object(d.a)(e.messages),[t.message]),typingUsers:e.typingUsers.filter((function(e){return e.id!==t.message.user.id}))});case"add-typing-user":return Object(j.a)(Object(j.a)({},e),{},{typingUsers:[].concat(Object(d.a)(e.typingUsers.filter((function(e){return e.id!==t.user.id}))),[t.user])});case"remove-typing-user":return Object(j.a)(Object(j.a)({},e),{},{typingUsers:e.typingUsers.filter((function(e){return e.id!==t.user.id}))});case"delete-all-messages":return Object(j.a)(Object(j.a)({},e),{},{messages:[]});case"set-user":return Object(j.a)(Object(j.a)({},e),{},{user:{id:t.payload.id,name:t.payload.name,room:t.payload.room}});case"set-userId":return Object(j.a)(Object(j.a)({},e),{},{user:Object(j.a)(Object(j.a)({},e.user),{},{id:t.userId})});case"remove-user":return Object(j.a)(Object(j.a)({},e),{},{user:{id:"",name:"",room:""},messages:[],typingUsers:[],onlineUsers:[]});case"update-users-list":return Object(j.a)(Object(j.a)({},e),{},{onlineUsers:t.users});default:return e}}}),F=Object(N.c)(T,Object(N.a)(U.a));o.a.render(Object(v.jsx)(r.a.StrictMode,{children:Object(v.jsx)(m.a,{store:F,children:Object(v.jsx)(R.a,{children:Object(v.jsx)(B,{})})})}),document.getElementById("root")),M()},18:function(e,t,n){e.exports={formBlock:"InitialForm_formBlock__rDqLk",input:"InitialForm_input__2EaoX",errorText:"InitialForm_errorText__3oVJl",button1:"InitialForm_button1__3XYse"}},59:function(e,t,n){e.exports={App:"App_App__16Ua0"}},69:function(e,t,n){},7:function(e,t,n){e.exports={chatWrapper:"ChatRoom_chatWrapper__1Ac5s",headerBlock:"ChatRoom_headerBlock__1XHYd",exitButton:"ChatRoom_exitButton__3DrH0",chatBlock:"ChatRoom_chatBlock__2dAOE",onlineUsersBlock:"ChatRoom_onlineUsersBlock__1InHk",messages:"ChatRoom_messages__kAgVk",mineMessage:"ChatRoom_mineMessage__1Btyi",strangeMessage:"ChatRoom_strangeMessage__32v9x",adminMessage:"ChatRoom_adminMessage__2qZvh",enterMessageBlock:"ChatRoom_enterMessageBlock__zQps6",textarea:"ChatRoom_textarea__233pv",enterButton:"ChatRoom_enterButton__anj6t"}}},[[105,1,2]]]);
//# sourceMappingURL=main.1128cb7c.chunk.js.map